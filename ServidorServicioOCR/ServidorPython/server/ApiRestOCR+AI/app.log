2025-05-20 23:21:29,028 - ERROR - Error en /ocr-file
Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 421, in procesar_ocr_archivo
    ticket = TicketResponse(**parsed)
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for TicketResponse
confianza
  Input should be a valid number [type=float_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/float_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 546, in endpoint_ocr_archivo
    resultado = procesar_ocr_archivo(file)
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 425, in procesar_ocr_archivo
    except (RateLimitError, APIError) as e:
            ^^^^^^^^^^^^^^
NameError: name 'RateLimitError' is not defined
2025-05-20 23:21:44,420 - ERROR - Error en /ocr-file
Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 421, in procesar_ocr_archivo
    ticket = TicketResponse(**parsed)
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for TicketResponse
confianza
  Input should be a valid number [type=float_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/float_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 546, in endpoint_ocr_archivo
    resultado = procesar_ocr_archivo(file)
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 425, in procesar_ocr_archivo
    except (RateLimitError, APIError) as e:
            ^^^^^^^^^^^^^^
NameError: name 'RateLimitError' is not defined
2025-05-20 23:25:15,862 - ERROR - Error en /ocr-file
Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 407, in procesar_ocr_archivo
    response = openai.ChatCompletion.create(
        model=MODEL,
    ...<9 lines>...
        max_tokens=1000
    )
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\openai\api_resources\chat_completion.py", line 25, in create
    return super().create(*args, **kwargs)
           ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\openai\api_resources\abstract\engine_api_resource.py", line 153, in create
    response, _, api_key = requestor.request(
                           ~~~~~~~~~~~~~~~~~^
        "post",
        ^^^^^^^
    ...<5 lines>...
        request_timeout=request_timeout,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\openai\api_requestor.py", line 298, in request
    resp, got_stream = self._interpret_response(result, stream)
                       ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\openai\api_requestor.py", line 700, in _interpret_response
    self._interpret_response_line(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        result.content.decode("utf-8"),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        stream=False,
        ^^^^^^^^^^^^^
    ),
    ^
  File "C:\Users\laure\AppData\Roaming\Python\Python313\site-packages\openai\api_requestor.py", line 765, in _interpret_response_line
    raise self.handle_error_response(
        rbody, rcode, resp.data, rheaders, stream_error=stream_error
    )
openai.error.InvalidRequestError: Invalid type for 'messages[1].content': expected one of a string or array of objects, but got an object instead.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 548, in endpoint_ocr_archivo
    resultado = procesar_ocr_archivo(file)
  File "C:\Users\laure\Desktop\ProyectoGestorGastos\ServidorServicioOCR\ServidorPython\server\ApiRestOCR+AI\OcrAiServer.py", line 427, in procesar_ocr_archivo
    except (RateLimitError, APIError) as e:
            ^^^^^^^^^^^^^^
NameError: name 'RateLimitError' is not defined
2025-05-20 23:26:17,465 - INFO - Texto extraído correctamente de imagen OCR.
2025-05-20 23:32:34,045 - INFO - Texto extraído correctamente de imagen OCR.
