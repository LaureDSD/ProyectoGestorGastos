<!--
  Componente de dashboard del sistema. Muestra métricas generales, gráficos de CPU y almacenamiento,
  y detalles técnicos del servidor. Se oculta el contenido principal mientras `load` es verdadero,
  mostrando un componente de carga personalizado.
-->

<!-- Spinner de carga centrado vertical y horizontalmente mientras `load` está activo -->
<div *ngIf="load" class="d-flex justify-content-center align-items-center" style="height: 80vh;">
  <!-- Componente de animación de carga -->
  <app-spinning2 class="p-3"></app-spinning2>
  Cargando..
</div>

<!-- Contenido principal visible solo cuando `load` es falso -->
<div *ngIf="!load" class="container mt-5 pt-4" style="margin-bottom: 18%">

  <!-- Sección de métricas principales del sistema: CPU, RAM, espacio libre, etc. -->
  <div class="row text-white text-center mb-4">
    <!-- Itera sobre la lista `metrics` para mostrar cada métrica con su valor y etiqueta -->
    <div class="col mt-3" *ngFor="let m of metrics">
      <div class="p-3 rounded shadow" [ngClass]="m.bg" style="min-width: 120px;">
        <h4 class="mb-0">{{ m.value }}</h4>
        <small>{{ m.label }}</small>
      </div>
    </div>
  </div>

  <!-- Sección de gráficos e información técnica del servidor -->
  <div class="row mb-3">

    <!-- Columna izquierda: Almacenamiento + Información general del sistema -->
    <div class="col-md-4 mb-3">
      <!-- Gráfico tipo donut con uso de almacenamiento -->
      <div class="card p-3 shadow mb-3">
        <h6>Almacenamiento</h6>
        <canvas baseChart
            [data]="donutData"
            [options]="donutOptions"
            [type]="'doughnut'">
        </canvas>
        <div class="text-center mt-2">{{ storageValue }} GB usados</div>
      </div>

      <!-- Información básica del servidor renderizada como lista -->
      <div class="card p-3 shadow bg-light">
        <h6 class="mb-3">Información del Servidor</h6>
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between">
            <strong>Nombre:</strong> <span>{{serverInfo.name}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Usuarios:</strong> <span>{{serverInfo.users}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Gastos registrados:</strong> <span>{{serverInfo.spenses}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>OCR python activo:</strong> <span>{{serverInfo.activeocr ? 'Sí' : 'No'}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>API python activo:</strong> <span>{{serverInfo.activeapi ? 'Sí' : 'No'}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Sistema operativo:</strong> <span>{{serverInfo.os}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Tiempo activo:</strong> <span>{{serverInfo.uptimeSeconds | secondsToHms}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Creado:</strong> <span>{{serverInfo.createdAt}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Última actualización:</strong> <span>{{serverInfo.updatedAt}}</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Error Log:</strong> <span> {{serverInfo.info ? serverInfo.info : "Sin errores"}}</span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Columna derecha: CPU + RAM -->
    <div class="col-md-8">
      <!-- Gráfico de línea que muestra la carga del CPU -->
      <div class="card p-3 shadow mb-3">
        <h6>CPU</h6>
        <canvas baseChart
          [data]="lineData"
          [options]="lineOptions"
          [type]="'line'">
        </canvas>
      </div>

      <!-- Detalles de memoria RAM y disco del servidor -->
      <div class="card p-3 shadow bg-light">
        <h6 class="mb-3">Información de Memoria RAM</h6>
        <ul class="list-group list-group-flush">
          <li class="list-group-item d-flex justify-content-between">
            <strong>Carga CPU:</strong> <span>{{serverInfo.cpuLoad | number:'1.2-2'}}%</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Temperatura CPU:</strong> <span>{{serverInfo.cpuTemperature | number:'1.1-1'}} °C</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Memoria total:</strong> <span>{{bytesToGB(serverInfo.totalMemory)}} GB</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Memoria usada:</strong> <span>{{bytesToGB(serverInfo.usedMemory)}} GB</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Disco total:</strong> <span>{{bytesToGB(serverInfo.totalDisk)}} GB</span>
          </li>
          <li class="list-group-item d-flex justify-content-between">
            <strong>Disco usado:</strong> <span>{{bytesToGB(serverInfo.usedDisk)}} GB</span>
          </li>
        </ul>
      </div>

      <!-- Gráfico de actividad RAM o uso de recursos en el tiempo -->
      <div class="card p-3 shadow mt-3 mb-4">
        <h6>Actividad</h6>
        <canvas baseChart
          [data]="barData"
          [options]="barOptions"
          [type]="'line'">
        </canvas>
      </div>
    </div>
  </div>
</div>
